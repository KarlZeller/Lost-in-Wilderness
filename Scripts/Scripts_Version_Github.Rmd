---
title: "Lost in Wilderness"
output: html_document
---


--------------------Google form


Library

Library 


Library
Bibliotheque

```{r}
library(PerformanceAnalytics)
library(EloChoice)
library(dplyr)
library(irr)
library(tidyr)
library(GGally)
library(reshape2)
library(lubridate)
library(ggplot2)
library(utils)
```

Recuperer les fichier des googleform

Download files from googleform


```{r}

gform_fr=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/GoogleForm/ggform_FR.csv"),header = F,skip=1,sep=";")  
gform_de=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/GoogleForm/ggform_DE.csv"),header = F,skip=1, sep=";")  
gform_es=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/GoogleForm/ggform_ES.csv"),header = F,skip=1, sep=";")  
gform_en=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/GoogleForm/ggform_EN.csv"),header = F,skip=1, sep=";")  

```

changer le nom des colonnes

Change the names of colomns
						
```{r}
names(gform_fr)=c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")

names(gform_de)=c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")

names(gform_es)=c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")

names(gform_en)=c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")
```


Suppression des colonnes en trop

Get rid of others colomns

```{r}
gform_fr = gform_fr [ , c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")]

gform_de = gform_de [ , c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")]

gform_es = gform_es [ , c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")]

gform_en = gform_en [ , c("Date","Sex","Hand","Age","Geo","GeoP","GeoM","Academic","Naturalist","Hobby","Film","Animal","Fear","Death","Eaten","Injured","Encounter","Phobia","Mail","judge_id")]

```


Changer la Date

Transformation de la colonne Date dans le bon format d'analyse avec fonction lubridate

On peut voir que les donnees de Date sont ordonnees en mois/jour/annees  heure/minutes/secondes

il faut donc utiliser la fonction mdy_hms


Change Date ==> Transform colomn Date in the proper writing

Our data are in month / day / year  hour/minute/second

We have to use fonction mdy_hms

```{r}
gform_fr$Date = mdy_hms(gform_fr$Date)
gform_de$Date = mdy_hms(gform_de$Date)
gform_es$Date = mdy_hms(gform_es$Date)
gform_en$Date = mdy_hms(gform_en$Date)
```


```{r}
gform_de$Geo = as.factor(gform_de$Geo)
gform_fr$Geo = as.factor(gform_fr$Geo)
gform_es$Geo = as.factor(gform_es$Geo)
gform_en$Geo = as.factor(gform_en$Geo)

gform_de$GeoM = as.factor(gform_de$GeoM)
gform_fr$GeoM = as.factor(gform_fr$GeoM)
gform_es$GeoM = as.factor(gform_es$GeoM)
gform_en$GeoM = as.factor(gform_en$GeoM)

gform_de$GeoP = as.factor(gform_de$GeoP)
gform_fr$GeoP = as.factor(gform_fr$GeoP)
gform_es$GeoP = as.factor(gform_es$GeoP)
gform_en$GeoP = as.factor(gform_en$GeoP)
```




Fusion des 4 tableaux
Rajout d'une colonne Langue pour avoir l'information

Addition of dataframe
Add a colomn Langue to know in wich language the participant fill the questionnaire

```{r}
gform_tot=bind_rows(Fr=gform_fr,De=gform_de,Es=gform_es,En=gform_en, .id = "Language")
```



```{r}
gform_tot


```



Supression des judge_id en double
=> la fonction supprime les numero d'anonymat en double et ceux qui n'ont pas de numero d'anonymat

```{r}
gform_tot = gform_tot %>% distinct(judge_id,.keep_all = TRUE)
```


Calcul du nombre de lignes en moins : soustraction entre le nombre de lignes avant et apres 

```{r}
gform_tot
```


Rajout d'une colonne Day pour avoir juste la date du jour

Add a colomn Day to only have the day 

```{r}
gform_tot$Day =  lubridate :: date(gform_tot$Date)
```



Convertir les donnees de chaque langue pour homogeneiser les reponses 

Convert data of each language in order to homogenize the answers



```{r}
gform_tot = mutate(gform_tot,
                   Sex = case_when(
                     Sex == "Homme" | Sex == "Mann " | Sex == "Man" | Sex == "Hombre" ~ "M",
                     Sex == "Femme" | Sex == "Frau" | Sex == "Woman" | Sex == "Mujer" ~ "F",
                     T ~ "Not mentioned" ))

gform_tot = mutate(gform_tot,
                   Hand = case_when(
                     Hand == "Droitier.e" | Hand == "Rechtshänder" | Hand == "Diestro" | Hand == "Right-handed" ~ "Right",
                     Hand == "Gaucher.e" | Hand == "Linkshänder" | Hand == "Zurdo.a" | Hand == "Left-handed" ~ "Left",
                     T ~ "Ambidextrous"))

gform_tot = mutate(gform_tot,
                   Geo = case_when(
                     Geo == "1"~ "Northern America",
                     Geo == "2"~ "Central America",
                     Geo == "3"~ "South America",
                     Geo == "4"~ "Caribbean",
                     Geo == "5"~ "Northern Europe",
                     Geo == "6"~ "Western Europe",
                     Geo == "7"~ "Southern Europe",
                     Geo == "8"~ "Eastern Europe",
                     Geo == "9"~ "Northern Africa",
                     Geo == "10"~ "Western Africa",
                     Geo == "11"~ "central Africa",
                     Geo == "12"~ "Eastern Africa",
                     Geo == "13"~ "Southern Africa",
                     Geo == "14"~ "Madagascar",
                     Geo == "15"~ "Western Asia",
                     Geo == "16"~ "Central Asia",
                     Geo == "17"~ "Southern Asia",
                     Geo == "18"~ "Eastern Asia",
                     Geo == "19"~ "Southeastern Asia",
                     Geo == "20"~ "Micronesia",
                     Geo == "21"~ "Polynesia",
                     Geo == "22"~ "Melanesia",
                     Geo == "23"~ "Australia and New Zealand",
                     T ~ "Na"))

gform_tot = mutate(gform_tot,
                   GeoM = case_when(
                     GeoM == "1"~ "Northern America",
                     GeoM == "2"~ "Central America",
                     GeoM == "3"~ "South America",
                     GeoM == "4"~ "Caribbean",
                     GeoM == "5"~ "Northern Europe",
                     GeoM == "6"~ "Western Europe",
                     GeoM == "7"~ "Southern Europe",
                     GeoM == "8"~ "Eastern Europe",
                     GeoM == "9"~ "Northern Africa",
                     GeoM == "10"~ "Western Africa",
                     GeoM == "11"~ "central Africa",
                     GeoM == "12"~ "Eastern Africa",
                     GeoM == "13"~ "Southern Africa",
                     GeoM == "14"~ "Madagascar",
                     GeoM == "15"~ "Western Asia",
                     GeoM == "16"~ "Central Asia",
                     GeoM == "17"~ "Southern Asia",
                     GeoM == "18"~ "Eastern Asia",
                     GeoM == "19"~ "Southeastern Asia",
                     GeoM == "20"~ "Micronesia",
                     GeoM == "21"~ "Polynesia",
                     GeoM == "22"~ "Melanesia",
                     GeoM == "23"~ "Australia and New Zealand",
                     T ~ "Na"))

gform_tot = mutate(gform_tot,
                  GeoP = case_when(
                    GeoP == "1"~ "Northern America",
                     GeoP == "2"~ "Central America",
                     GeoP == "3"~ "South America",
                     GeoP == "4"~ "Caribbean",
                     GeoP == "5"~ "Northern Europe",
                     GeoP == "6"~ "Western Europe",
                     GeoP == "7"~ "Southern Europe",
                     GeoP == "8"~ "Eastern Europe",
                     GeoP == "9"~ "Northern Africa",
                     GeoP == "10"~ "Western Africa",
                     GeoP == "11"~ "central Africa",
                     GeoP == "12"~ "Eastern Africa",
                     GeoP == "13"~ "Southern Africa",
                     GeoP == "14"~ "Madagascar",
                     GeoP == "15"~ "Western Asia",
                     GeoP == "16"~ "Central Asia",
                     GeoP == "17"~ "Southern Asia",
                     GeoP == "18"~ "Eastern Asia",
                     GeoP == "19"~ "Southeastern Asia",
                     GeoP == "20"~ "Micronesia",
                     GeoP == "21"~ "Polynesia",
                     GeoP == "22"~ "Melanesia",
                     GeoP == "23"~ "Australia and New Zealand",
                     T ~ "Na"))

gform_tot = mutate(gform_tot,
                   Academic = case_when(
                     Academic == "Je ne suis pas encore à l'école / Je suis à la Maternelle" | Academic == "Ich bin noch nicht in der Schule / Ich bin im Kindergarten" | Academic == "Todavía no estoy en la escuela / Estoy en kindergarten" | Academic == "I'm not yet in school / I'm in Kindergarten" ~ "Kindergarten",
                     
                     Academic == "Je suis à l'école primaire" | Academic == "Ich bin in der Grundschule" | Academic == "Estoy en primaria" | Academic == "I'm in primary school" ~ "Primary school",
                     
                     Academic == "Je suis au collège" | Academic == "Ich bin in der Mittelschule" | Academic == "Estoy en la secundaria" | Academic == "I'm in middle school" ~ "Middle school",
                     
                     Academic == "Je suis au lycée" | Academic == "Ich bin im Gymnasium" | Academic == "Estoy en el instituto" | Academic == "I'm in high school" ~ "High school",
                     
                     Academic == "Baccalauréat" | Academic == "Abitur" | Academic == "Bachillerato" | Academic == "High school diploma" ~ "High school diploma",
                     
                     Academic == "Bac +1 / Bac +2 / Bac +3 (Licence, etc...)" | Academic == "Ein / zwei / dreijähriger technischer / universitärer Abschluss" | Academic == "Título técnico / universitario de uno / dos / tres años (Diplomatura o equivalente)" | Academic == "One/two/three-year technical/university degree" ~ "One/two/three-year technical/university degree",
                     
                     Academic == "Bac +4 / Bac +5 (Master, etc...)" | Academic == "Master-Abschluss" | Academic == "Licenciatura" | Academic == "Master's degree" ~ "Master's degree",
                     
                     Academic == "Doctorat et plus" | Academic == "PhD und mehr" | Academic == "PhD and more" | Academic == "Doctorado y más" ~ "PhD and more",
                     
                     T ~ "Other"))

gform_tot = mutate(gform_tot,
                   Naturalist = case_when(
                     Naturalist == "Très faibles" | Naturalist == "Sehr schlecht" | Naturalist == "Muy débiles" | Naturalist == "Very weak" ~ "Very weak",
                     
                     Naturalist == "Faibles" | Naturalist == "Schlecht" | Naturalist == "Débiles" | Naturalist == "Weak" ~ "Weak",
                     
                     Naturalist == "Moyennes" | Naturalist == "Durchschnitt" | Naturalist == "Promedias" | Naturalist == "Average" ~ "Average",
                     
                     Naturalist == "Bonnes" | Naturalist == "Gut" | Naturalist == "Buenas" | Naturalist == "Good" ~ "Good",
                     
                     T ~ "Very good"))


gform_tot = mutate(gform_tot,
                   Hobby = case_when(
                     Hobby == "Littérature/Histoire/Musique/Danse/Théatre" | Hobby == "Literatur / Geschichte / Musik / Tanz / Schauspiel" | Hobby == "Literatura/Historia/Música/Danza/Teatro" | Hobby == "Literature/History/Music/Dance/Acting" ~ "Literature/History/Music/Dance/Acting",
                     
                     Hobby == "Sport/Fitness/Auto/Moto" | Hobby == "Sport / Fitness / Auto / Motorrad" | Hobby == "Deporte/Fitness/Auto/Moto" | Hobby == "Sport/Fitness/Auto/Moto" ~ "Sport/Fitness/Auto/Moto",
                     
                     Hobby == "Nature/Ecologie/Animaux" | Hobby == "Natur / Ökologie / Tiere" | Hobby == "Naturaleza/Ecología/Animales" | Hobby == "Nature/Ecology/Animals" ~ "Nature/Ecology/Animals",
                     
                     Hobby == "Cuisine/Bricolage/Maison" | Hobby == "Kochen / Basteln / Heim" | Hobby == "Cocina / Bricolaje / Hogar" | Hobby == "Cooking/Crafting/Home" ~ "Cooking/Crafting/Home",
                     
                     Hobby == "Informatique/Jeux-video/Média/Sciences/Technologies" | Hobby == "Informatik / Videospiele / Medien / Wissenschaften / Technologien" | Hobby == "Informática/Videojuegos/Medios/Ciencias/Tecnologías" | Hobby == "Computer science/Video games/Media/Sciences/Technologies" ~ "Computer science/Video games/Media/Sciences/Technologies",
                     
                     T ~ "Others"))


gform_tot = mutate(gform_tot,
                   Film = case_when(
                     Film == "Dessin animé" | Film == "Trickfilm" | Film == "Película animada" | Film == "Cartoon" ~ "Cartoon",
                     
                     Film == "Film d'angoisse-épouvante avec des animaux" | Film == "Horrorfilm mit Tieren" | Film == "Película de terror y ansiedad con animales" | Film == "Anxiety-horror movie with animals" ~ "Anxiety-horror movie with animals",
                     
                     Film == "Documentaire animalier" | Film == "Natur-Dokumentarfilm" | Film == "Documental animal" | Film == "Wildlife documentary" ~ "Wildlife documentary",
                     
                     T ~ "Do something else"))


 gform_tot = mutate(gform_tot,
                  Animal = case_when(
                    Animal == "Animal 1" | Animal == "Tier 1" ~ "Panthera_tigris",
                    Animal == "Animal 2"| Animal == "Tier 2" ~ "Pithecophaga_jefferyi",
                    Animal == "Animal 3"| Animal == "Tier 3" ~ "Bitis_gabonica",
                    Animal == "Animal 4"| Animal == "Tier 4" ~ "Mandrillus_leucophaeus",
                    Animal == "Animal 5"| Animal == "Tier 5" ~ "Hipposideros_speoris",
                    Animal == "Animal 6"| Animal == "Tier 6" ~ "Desert_Wolf_Spider",
                    Animal == "Animal 7"| Animal == "Tier 7" ~ "Canis_Rufus",
          
                     T ~ "Ursus_americanus"))

 
 
gform_tot = mutate(gform_tot,
                  Death = case_when(
                    Death == "Yes" | Death == "Oui" | Death == "Ja" | Death == "Si" ~ "Yes",
                    Death == "No" | Death == "Nein" | Death == "Non" ~ "No",
                  
                     T ~ "Do not know"))



gform_tot = mutate(gform_tot,
                  Eaten = case_when(
                    Eaten == "Yes" | Eaten == "Oui" | Eaten == "Ja" | Eaten == "Si" ~ "Yes",
                    Eaten == "No" | Eaten == "Nein" | Eaten == "Non" ~ "No",
                  
                     T ~ "Do not know"))



gform_tot = mutate(gform_tot,
                  Injured = case_when(
                    Injured == "Yes" | Injured == "Oui" | Injured == "Ja" | Injured == "Si" ~ "Yes",
                    Injured == "No" | Injured == "Nein" | Injured == "Non" ~ "No",
                  
                     T ~ "Do not know"))



gform_tot = mutate(gform_tot,
                  Encounter = case_when(
                    Encounter == "Oui, dans la nature" | Encounter == "Ja, in freier Wildbahn" | Encounter == "Yes, in the wild" | Encounter == "Si, en la naturaleza" ~ "In the wild",
                    Encounter == "Oui, en captivité" | Encounter == "Ja, in Gefangenschaft" | Encounter == "Si, en cautiverio" | Encounter == "Yes, in captivity" ~ "In captivity",
                  
                     T ~ "No"))



gform_tot = mutate(gform_tot,
                  Phobia = case_when(
                    Phobia == "Des serpents" | Phobia == "Vor Schlangen" | Phobia == "A los serpientes" | Phobia == "For snakes" ~ "Snakes",
                    Phobia == "Des araignées" | Phobia == "Vor Spinnen" | Phobia == "A las arañas" | Phobia == "For spiders" ~ "Spiders",
                    Phobia == "Des serpents et des araignées" | Phobia == "Vor Schlangen und Spinnen" | Phobia == "A los serpientes y las arañas" | Phobia == "For snakes and spiders" ~ "Snakes and Spiders",
                    
                  Phobia == "D'un autre animal" | Phobia == "Vor anderen Tieren" | Phobia == "A otro aimal" | Phobia == "For another animal" ~ "Another animal",

                     T ~ "Don't have an animal phobia"))
```


Toutes les colonnes sont des chaines de caracteres sauf l'age et la reaction de peur
Nous voulons des Facteurs


```{r}
gform_tot$Language = factor(gform_tot$Language)
gform_tot$Sex = factor(gform_tot$Sex)
gform_tot$Hand = factor(gform_tot$Hand)
gform_tot$Geo = factor(gform_tot$Geo)
gform_tot$GeoP =  factor(gform_tot$GeoP)
gform_tot$GeoM = factor(gform_tot$GeoM)
gform_tot$Academic =  factor(gform_tot$Academic)
gform_tot$Naturalist =  factor(gform_tot$Naturalist)
gform_tot$Hobby =  factor(gform_tot$Hobby)
gform_tot$Film =  factor(gform_tot$Film)
gform_tot$Animal =  factor(gform_tot$Animal)
gform_tot$Death =  factor(gform_tot$Death)
gform_tot$Fear =  factor(gform_tot$Fear)
gform_tot$Eaten =  factor(gform_tot$Eaten)
gform_tot$Injured =  factor(gform_tot$Injured)
gform_tot$Encounter =  factor(gform_tot$Encounter)
gform_tot$Phobia =  factor(gform_tot$Phobia)
gform_tot$judge_id =  factor(gform_tot$judge_id)


write.csv(gform_tot, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Clean Data/GoogleForm/gform_tot.csv"), row.names=T)


```






Comptabiliser le nombre de reponses pour un critere dans le tableau

Creation d'un dataframe identique a gform_tot qui compte le nombre d'individus appartenant a un critere

comme par exemple Western Africa de la colonne Geo

```{r}
gform_tot_count = gform_tot

gform_tot_count$Count = 0  # remplir la colonne Count avec que des 0

gform_tot_count$Count= as.numeric(gform_tot_count$Count)

for (i in 1:length(gform_tot_count[,1])) {
  if (gform_tot_count[i,6] == "Western Africa"){               # 6 car 6eme colonne est Geo
    gform_tot_count[i+1,23] = gform_tot_count[i,23] + 1   # 23 car 23eme colonne est Count
  } 
  else (gform_tot_count[i+1,23] = gform_tot_count[i,23])
}

```


Supprimer les valeurs en doubles selon la colonne count ==> ne garde que la premiere occurence
Ne garde que les lignes dont le nombre de participation (colonne Count) change

```{r}
gform_tot_count = gform_tot_count %>% distinct(Count,.keep_all = TRUE)
```


```{r}
Graph_Geo_Western_Africa=ggplot(gform_tot_count, aes(x=Day ,y=Count)) + 
  geom_point()+

  ylab("Number of participants")  + 
  xlab("Day") + 
  ggtitle("Western Africa") + 
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))
 
  
 
Graph_Geo_Western_Africa


ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Graph_Geo_Western_Africa.jpg", plot = Graph_Geo_Western_Africa, width = 11, height = 8)
```




Graphique de participation en fonction de l'age

```{r}
Graph_Age=ggplot(data  = gform_tot,aes(x=Age))+
  geom_bar()+
  
   ylab("Number of participants")  + 
   xlab("Age") + 
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))
 

Graph_Age


ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Graph_Age.jpg", plot = Graph_Age, width = 11, height = 8)
```

Graphique de participation en fonction du niveau academique


```{r}
Graph_Academie=ggplot(data=gform_tot,aes(x=Academic,fill=Academic))+
  geom_bar(stat="count")+
  
  
  ylab("Number of participants")  + 
  xlab("") + 
  ggtitle("") + 
  
  scale_fill_discrete(name = "Academic Level")+
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  theme(axis.text.x = element_blank())


Graph_Academie

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Graph_Academie.jpg", plot = Graph_Academie, width = 11, height = 8)

```

Graphique de participation en fonction de la zone geographique

```{r}
Graph_Geo=ggplot(data=gform_tot,aes(x=Geo,fill=Geo))+
  geom_bar(stat="count")+
  
  
  ylab("Number of participants")  + 
  xlab("") + 
  ggtitle("") + 
  
  scale_fill_discrete(name = "Geographical area")+
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  theme(axis.text.x = element_blank())


Graph_Geo

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Graph_Geo.jpg", plot = Graph_Geo, width = 11, height = 8)
```

Graphique de participation en fonction du Hobby


```{r}
Graph_Hobby=ggplot(data=gform_tot,aes(x=Hobby,fill=Hobby))+
  geom_bar(stat="count")+
  
  
  ylab("Number of participants")  + 
  xlab("") + 
  ggtitle("") + 
  
  scale_fill_discrete(name = "Hobby")+
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  theme(axis.text.x = element_blank())


Graph_Hobby


ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Graph_Hobby.jpg", plot = Graph_Hobby, width = 11, height = 8)
```





---------------------------------------ELO Score



Choisir les tabeaux de resultats selon les 4 traductions

```{r}
Elo_fr=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/EloScore/Elo_fr.csv"),header = T, sep=",")  
Elo_es=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/EloScore/Elo_es.csv"),header = T, sep=",")  
Elo_de=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/EloScore/Elo_de.csv"),header = T, sep=",")  
Elo_en=read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Data/EloScore/Elo_en.csv"),header = T, sep=",")  
```


Regroupement des 4 tableaux en ajoutant une colonne (source) qui indique l'origine de la ligne


```{r}
Elo_tot=bind_rows(Fr=Elo_fr, Es =Elo_es, En =Elo_en, De =Elo_de ,.id = "Language")
```


-------------------------------CALCUL DU ELO SCORE



Utilisation de la fonction format_data.


```{r}
Elo_tot=format_data(Elo_tot)

Elo_tot

write.csv(Elo_tot, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Clean Data/EloScore/Elo_tot.csv"), row.names=T)

```



Utilisation de la fonction elochoice du package EloChoice

```{r}
Elo <- elochoice(winner = Elo_tot$winner, loser = Elo_tot$loser, startvalue = 1500, runs = 100)

save(Elo, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/EloScore/Elo.RData"))
```


Stockages des EloScore. Classement des especes par ordre croissant de score Elo.


```{r}

Elo_all<- ratings(Elo, drawplot=F) 

Elo_all<- Elo_all[sort(names(Elo_all))]

species <- sort(unique(c(as.character(Elo_tot$challenger_1), as.character(Elo_tot$challenger_2))),decreasing = F)

Elo_all<- data.frame(Name=species, EloScore=Elo_all, row.names = NULL)

Elo_all<- Elo_all[order(Elo_all$EloScore, decreasing =F),]

Elo_all$EloRank <- order(Elo_all$EloScore, decreasing=F) 

Elo_all


write.csv(Elo_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/EloScore/Elo_all.csv"), row.names=T)


```



```{r}
classement=ggplot(Elo_all, aes(x=EloRank , y = EloScore)) + 
  geom_point() +
  ylab("Elo Score")  + 
  xlab("RanK") + 
  ggtitle("Pictures ranking") +
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))
  
  
classement

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement.jpg", plot = classement, width = 11, height = 8)
```



Distinction des groupes d'animaux.

Ajout de colonnes avec indication de groupes
(predateur, dangeureux etc...)

Fichier "Goups"

```{r}
Groups = read.csv(file=file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Tools/Groups.csv"),header = T, sep=";") 
Groups


```

Association des deux tableaux

Test avec fonction left_join ou fonction merge ou fonction full_join

```{r}

Elo_all_Groups = left_join(Elo_all,Groups, by=c(Name="Name2"))

Elo_all_Groups


write.csv(Elo_all_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/EloScore/Elo_all_Groups.csv.csv"), row.names=T)


```


Test pour verifier que l'on obtient le meme graphique de classement



```{r}
classement_test=ggplot(Elo_all_Groups, aes(x=EloRank , y =EloScore)) + 
  geom_point()  +
  ylab("Elo Score")  + 
  xlab("RanK") + 
  ggtitle("Pictures ranking") +
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))
  
  
classement_test

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classementtest.jpg", plot = classement_test, width = 11, height = 8)
```




Classement selon sous groupe

```{r}
classement_subgroup=ggplot(Elo_all_Groups, aes(x=EloRank , y =EloScore, color=Subgroup )) + 
  geom_point() +
  
  scale_color_discrete(name = "Group")+
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures ranking") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))
 
classement_subgroup

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_Subgroup.jpg", plot = classement_subgroup, width = 11, height = 8)
```


Beaucoup de Sous groupes ==> difficultes de lecture

Mise en evidence de groupes d'interets : Felin Rapace Primate Serpent Araignee Canin Croc Ours Hyene Autres

Creation nouveau tableau avec nouvelle colonne interet qui repertorie les groupes que l'on souhaite mettre en evidence dans le graphique


```{r}
Elo_all_Groups_Interet =Elo_all_Groups
Elo_all_Groups_Interet =  mutate(Elo_all_Groups_Interet,
                    Interet = case_when(
                    Subgroup == "Felidae" ~ "Felidae",
                    Subgroup == "Spider"~ "Spider",
                    Subgroup == "Raptor"~ "Raptor",
                    Subgroup == "Snake"~ "Snake",
                    Subgroup == "Crocodile"~ "Crocodile",
                    Subgroup == "Canidae"~ "Canidae",
                    Subgroup == "Ursus"~ "Ursus",
                    Subgroup == "Hyenidae"~"Hyenidae",
                    Subgroup == "Primate"~ "Primate",
                     T ~ "Others"))



write.csv(Elo_all_Groups_Interet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/EloScore/Elo_all_Groups_Interet.csv"), row.names=T)

```

Choix des groupes a mettre en evidence par couleur et forme
ggplot classe par ordre alphanumerique



```{r}
classement_Interet=ggplot(Elo_all_Groups_Interet, aes(x=EloRank , y =EloScore , col=Interet, shape = Interet,size=Interet)) + 
  geom_point() +
  
  
  scale_color_manual(name = "Group",values=c("grey","green","red","grey","grey","grey","blue","purple","yellow","brown"))+
  scale_shape_manual(name = "Group",values=c(17,17,17,17,17,17,17,17,17,17))+
  scale_size_manual(name = "Group",values=c(1,4,4,1,1,1,4,4,4,4))+
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  
  ggtitle("Pictures ranking") +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  theme(axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) 
  
  
  
classement_Interet


ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_Interet.jpg", plot = classement_Interet, width = 11, height = 8)
```




Classement selon predation sur primates

```{r}
classement_primates_predator=ggplot(Elo_all_Groups_Interet, aes(x=EloRank , y =EloScore , col=PredatorPrimates, shape=PredatorPrimates, size=PredatorPrimates)) + 
  geom_point() +
  
  scale_color_manual(name="Predator\nof primates",values=c("#0000FF","#FF0000"),labels=c("No","Yes"))+
  scale_shape_manual(name="Predator\nof primates",values=c(16, 17),labels=c("No","Yes"))+
  scale_size_manual(name="Predator\nof primates",values=c(4,5),labels=c("No","Yes"))+
  
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=15))+
  
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures ranking") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))
  
  
classement_primates_predator

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_primates_predator.jpg", plot = classement_primates_predator, width = 11, height = 8)
```




Classement selon dangerosite pour l'humain

```{r}
classement_danger=ggplot(Elo_all_Groups_Interet, aes(x=EloRank , y =EloScore , col=Dangerous, shape=Dangerous, size=Dangerous)) + 
  geom_point() +

  scale_color_manual(name="Dangerous\nanimal\nfor humans",values=c("#0000FF","#FF0000"),labels=c("No","Yes"))+
  scale_shape_manual(name="Dangerous\nanimal\nfor humans",values=c(16, 17),labels=c("No","Yes"))+
  scale_size_manual(name="Dangerous\nanimal\nfor humans",values=c(4,5),labels=c("No","Yes"))+
  
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=15))+
  
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures ranking") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))
  
  
classement_danger

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_danger.jpg", plot = classement_danger, width = 11, height = 8)
```




--------Stabilisation des scores


Utilisation de la fonction booting_elo


Utilisation de la fonction opti_minmatch


Utilisation de la fonction opti_maxmatch


Stabilisation des scores en fonction du nombre de duels


```{r}
Elo_stab=booting_elo(Elo_tot,startvalue=1500,runs=10,stepelo=2000)

Elo_stab


write.csv(Elo_stab, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/EloStab/Elo_stab.csv"), row.names=T)

```



Stabilisation Score de la photo qui fait le plus peur = Crocodylus porosus


```{r}
stabgraph_1=ggplot(Elo_stab, aes (x=match_nb, y= Crocodylus_porosus)) + 
  ylim(800,2200)  + 
  ylab("Elo Score")  + 
  xlab("Number of duels") + 
  ggtitle("Stabilization of the Elo Score of Crocodylus porosus") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  geom_line(linetype = "solid", color="black", lwd=2) +
  geom_hline(yintercept=max(Elo_all$EloScore), linetype="dashed", color = "red", size=1) + 
  geom_hline(yintercept=min(Elo_all$EloScore), linetype="dashed", color = "blue", size=1) + 
  geom_hline(yintercept=mean(Elo_all$EloScore), linetype="dashed", color = "green", size=1) 


stabgraph_1

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Stab_Crocodylus_porosus.jpg", plot = stabgraph_1, width = 11, height = 8)
```




Stabilisation Score de la photo qui fait le moins peur = Oryctolagus cuniculus 2


```{r}
stabgraph_2=ggplot(Elo_stab, aes (x=match_nb, y= Oryctolagus_cuniculus2)) + 
  
  ylim(700,2200)  + 
  ylab("Elo Score")  + 
  xlab("Number of duels") + 
  ggtitle("Stabilization of the Elo Score of Oryctolagus cuniculus ") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  geom_line(linetype = "solid", color="black", lwd=2) +
  geom_hline(yintercept=max(Elo_all$EloScore), linetype="dashed", color = "red", size=1) + 
  geom_hline(yintercept=min(Elo_all$EloScore), linetype="dashed", color = "blue", size=1) + 
  geom_hline(yintercept=mean(Elo_all$EloScore), linetype="dashed", color = "green", size=1) 


stabgraph_2

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Stab_Oryctolagus_cuniculus2.jpg", plot = stabgraph_2, width = 11, height = 8)
```






----------Couplage du tableau avec les EloScore et du tableau avec les reponses aux GoogleForm

Calculer des Scores Elo selon des criteres de distinction entre participants comme l'age, la zone geographique (du participant, du pere, de la mere), le niveau academique, les conaissances naturalistes, le principal centre d'interet, les phobies.



Utilisation de la fonction get_BDD_elo

Utilisation de la fonction past_BDD_elo


-----------Critere SEXE




```{r}
table(gform_tot$Sex)
```


Convertir les colonnes en facteur

```{r}
gform_tot$Language= as.factor(gform_tot$Language)
gform_tot$Date= as.factor(gform_tot$Date)
gform_tot$Sex= as.factor(gform_tot$Sex)
gform_tot$Hand= as.factor(gform_tot$Hand)
gform_tot$Geo= as.factor(gform_tot$Geo)
gform_tot$GeoP= as.factor(gform_tot$GeoP)
gform_tot$GeoM= as.factor(gform_tot$GeoM)
gform_tot$Academic= as.factor(gform_tot$Academic)
gform_tot$Naturalist= as.factor(gform_tot$Naturalist)
gform_tot$Hobby= as.factor(gform_tot$Hobby)
gform_tot$Fear= as.factor(gform_tot$Fear)
gform_tot$Film= as.factor(gform_tot$Film)
gform_tot$Animal= as.factor(gform_tot$Animal)
gform_tot$Death= as.factor(gform_tot$Death)
gform_tot$Eaten= as.factor(gform_tot$Eaten)
gform_tot$Injured= as.factor(gform_tot$Injured)
gform_tot$Encounter= as.factor(gform_tot$Encounter)
gform_tot$Phobia= as.factor(gform_tot$Phobia)
gform_tot$Mail= as.factor(gform_tot$Mail)
gform_tot$judge_id= as.factor(gform_tot$judge_id)
```



Tableaux avec les rangs

```{r}
BDD_sexe_rang <- past_BDD_elo(Elo_tot, gform_tot, "Sex", type="rank", runs = 100)

#BDD_sexe_rang<-rang_BDD_sexe[, c("A1", "A2", "A3")] ==> enlever colonne des especes

write.csv(BDD_sexe_rang, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_rang.csv"), row.names=T)

```

Tableaux avec les scores

```{r}
BDD_sexe_score <- past_BDD_elo(Elo_tot, gform_tot, "Sex", type="Score", runs = 100) 

#BDD_sexe_score <- BDD_sexe[, c("A1","A2","A3")]  ==> enlever colonne des especes

write.csv(BDD_sexe_score, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_score.csv"), row.names=F)
```

Coefficient de Kendall

```{r}
kendall(BDD_sexe_score[, c("F", "M","Not mentioned")])
```




Coefficient de Correlation Intra-classe

Modele a deux facteurs a effets aleatoires (two-way random). Un ensemble de k evaluateurs sont choisis au hasard, puis chaque individu est mesure par le même ensemble de k evaluateurs ayant des caracteristiques similaires. Dans ce modele, les individus et les evaluateurs sont consideres comme des effets aleatoires. Le modele a deux facteurs aleatoires est choisi si nous prevoyons de generaliser nos resultats de fiabilite a tout evaluateur qui possede les mêmes caracteristiques que les evaluateurs selectionnes dans l’etude de fiabilite. Ce modele convient a l’evaluation des methodes d’evaluation clinique fondees qui sont conçues pour être utilise en routine.

Si l’unite d’analyse est une moyenne de plusieurs evaluations, l’unite doit être remplacee par “average”.



```{r}
icc(BDD_sexe_score[, c("F", "M","Not mentioned")], model="twoway", type="consistency", unit="average")
```


```{r}
Corelation_Sex = ggplot(BDD_sexe_score, aes(F,M)) +
  
  xlim(800,2000)+
  ylim(800,2000)+
  
  geom_point() +
  geom_smooth()+
  
  
  ylab("Female")  + 
  xlab("Male") + 
    ggtitle("Elo Score correlation between gender") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))

Corelation_Sex
  
ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Correlation_Sex.jpg", plot = Corelation_Sex, width = 11, height = 8)
  
```

Fonction des correlations croisees entre A1 A2 et A3

```{r}

cor_tot = chart.Correlation(BDD_sexe_score[, c("F", "M","Not mentioned")],histogram=TRUE,pch=19)

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Cor_Sex.jpg", plot = cor_tot, width = 11, height = 8)
```


Création tableaux
Name - Score - Sexe
Name - Rang - Sexe


==> Faire des graphiques et des analyses plus simples


Enlever la colonne X dans tableau BDD_sexe_rang
```{r}
BDD_sexe_rang<-BDD_sexe_rang[, c("name", "F", "M","Not mentioned")]
```

Transformation des tableaux variables en tableaux observations

```{r}

BDD_sexe_score_all = melt ( BDD_sexe_score, id.vars = c("name"))


BDD_sexe_rang_all = melt ( BDD_sexe_rang, id.vars = c("name"))


write.csv(BDD_sexe_score_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_score_all.csv"), row.names=F)


write.csv(BDD_sexe_rang_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_rang_all.csv"), row.names=F)
```


Renommer les noms des variables

```{r}
names(BDD_sexe_score_all) = c("Name","Sex","EloScore")
names(BDD_sexe_rang_all) = c("Name","Sex","EloRank")
```

Combiner Tableaux rang et score
```{r}
BDD_sexe_complet <- left_join(BDD_sexe_score_all, BDD_sexe_rang_all, by=c("Name","Sex"))


write.csv(BDD_sexe_complet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_complet.csv"), row.names=F)

BDD_sexe_complet

```

Ranger le tableaux selon les rang

```{r}
BDD_sexe_complet<- BDD_sexe_complet[order(BDD_sexe_complet$EloRank, decreasing =F),]
```

Graphique des Scores selon les Sexes

```{r}
classement_sexe=ggplot(BDD_sexe_complet, aes(x=EloRank , y =EloScore , col =Sex)) + 
  geom_point() +
  scale_color_manual(name = "Sex", values = c("blue","red","green"), labels = c("Female","Male", "Not mentioned"))+
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures Ranking ") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14)) + 
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))
 
  
  
classement_sexe

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_Sex.jpg", plot = classement_sexe, width = 11, height = 8)

```


Utilisation du tableau Groups pour faire des groupes d'animaux
Comparaison des moyennes des scores des groupes d'animaux selon le sexe


```{r}

BDD_sexe_score_Groups = left_join(BDD_sexe_score,Groups, by=c(name="Name2"))


write.csv(BDD_sexe_score_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_score_Groups.csv"), row.names=F)

```



```{r}

BDD_sexe_complet_Groups = left_join(BDD_sexe_complet,Groups, by=c(Name="Name2"))


write.csv(BDD_sexe_complet_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_complet_Groups.csv"), row.names=F)

```



Creation nouveau tableau avec nouvelle colonne interet qui repertorie les groupes que l'on souhaite mettre en evidence dans le graphique


```{r}
BDD_sexe_complet_Groups_Interet =  mutate(BDD_sexe_complet_Groups,
                    Interet = case_when(
                    Subgroup == "Felidae" ~ "Felidae",
                    Subgroup == "Spider"~ "Spider",
                    Subgroup == "Raptor"~ "Raptor",
                    Subgroup == "Snake"~ "Snake",
                    Subgroup == "Crocodile"~ "Crocodile",
                    Subgroup == "Canidae"~ "Canidae",
                    Subgroup == "Ursus"~ "Ursus",
                    Subgroup == "Hyenidae"~"Hyenidae",
                    Subgroup == "Primate"~ "Primate",
                     T ~ "Others"))



write.csv(BDD_sexe_complet_Groups_Interet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDSex/BDD_sexe_complet_Groups_Interet.csv"), row.names=T)

```



Graphique Boxplot

```{r}
Score_Sex_Boxplot_Interet=ggplot(BDD_sexe_complet_Groups_Interet, aes(x=Interet , y =EloScore , col=Sex)) + 
  geom_boxplot() +
  
  
 scale_color_manual(name = "Sex", values = c("blue","red","green"), labels = c("Female","Male", "Not mentioned"))+
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  
  ylab("Elo Score")  + 
  xlab("Group") + 
  
  ggtitle("Elo Score") +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  theme(axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) 
  
  
  
Score_Sex_Boxplot_Interet

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Boxplot_sex.jpg", plot = Score_Sex_Boxplot_Interet, width = 11, height = 8)
```








-----------Critere Age


```{r}
table(gform_tot$Age)
```


Regroupons des categories

```{r}
gform_tot_age =  mutate(gform_tot,
                    CatAge = case_when(
                    Age < 30  ~ "- 30 years old",
                    
                     T ~ "+ 30 years old"))


gform_tot_age$CatAge = as.factor(gform_tot_age$CatAge)

write.csv(gform_tot_age, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/clean Data/GoogleForm/gform_tot_age.csv"), row.names=T)
```





Tableaux avec les rangs

```{r}
BDD_age_rang <- past_BDD_elo(Elo_tot, gform_tot_age, "CatAge", type="rank", runs = 100)

write.csv(BDD_age_rang, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAge/BDD_age_rang.csv"), row.names=T)

```

Tableaux avec les scores

```{r}
BDD_age_score <- past_BDD_elo(Elo_tot, gform_tot_age, "CatAge", type="Score", runs = 100) 


write.csv(BDD_age_score, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDage/BDD_age_score.csv"), row.names=F)
```




```{r}
kendall(BDD_age_score[, c("- 30 years old","+ 30 years old")])
```




Coefficient de Correlation Intra-classe



```{r}
icc(BDD_age_score[, c("- 30 years old","+ 30 years old")], model="twoway", type="consistency", unit="average")
```


Fonction des correlations croisees entre A1 A2 et A3

```{r}

gg1 = chart.Correlation(BDD_age_score[, c("- 30 years old","+ 30 years old")],histogram=TRUE,pch=19)
gg1

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Cor_Age.jpg", plot = gg1, width = 11, height = 8)
```


==> Faire des graphiques et des analyses plus simples


Transformation des tableaux variables en tableaux observations

```{r}

BDD_age_score_all = melt ( BDD_age_score, id.vars = c("name"))


BDD_age_rang_all = melt ( BDD_age_rang, id.vars = c("name"))


write.csv(BDD_age_score_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDage/BDD_age_score_all.csv"), row.names=F)


write.csv(BDD_age_rang_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDage/BDD_age_rang_all.csv"), row.names=F)
```


Renommer les noms des variables

```{r}
names(BDD_age_score_all) = c("Name","Age","EloScore")
names(BDD_age_rang_all) = c("Name","Age","EloRank")
```

Combiner Tableaux rang et score
```{r}
BDD_age_complet <- left_join(BDD_age_score_all, BDD_age_rang_all, by=c("Name","Age"))


write.csv(BDD_age_complet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAge/BDD_age_complet.csv"), row.names=F)

```

Ranger le tableaux selon les rang

```{r}
BDD_age_complet<- BDD_age_complet[order(BDD_age_complet$EloRank, decreasing =F),]
```

Graphique des Scores selon les Sexes

```{r}
classement_age=ggplot(BDD_age_complet, aes(x=EloRank , y =EloScore , col =Age)) + 
  geom_point() +
  scale_color_manual(name = "Age", values = c("blue","red"))+
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures Ranking ") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14)) + 
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))
 
  
  
classement_age

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_age.jpg", plot = classement_sexe, width = 11, height = 8)
```


Utilisation du tableau Groups pour faire des groupes d'animaux
Comparaison des moyennes des scores des groupes d'animaux selon le sexe


```{r}

BDD_age_score_Groups = left_join(BDD_age_score,Groups, by=c(name="Name2"))


write.csv(BDD_age_score_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAge/BDD_age_score_Groups.csv"), row.names=F)

```



```{r}

BDD_age_complet_Groups = left_join(BDD_age_complet,Groups, by=c(Name="Name2"))


write.csv(BDD_age_complet_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAge/BDD_age_complet_Groups.csv"), row.names=F)

```


Creation nouveau tableau avec nouvelle colonne interet qui repertorie les groupes que l'on souhaite mettre en evidence dans le graphique


```{r}
BDD_age_complet_Groups_Interet =  mutate(BDD_age_complet_Groups,
                    Interet = case_when(
                    Subgroup == "Felidae" ~ "Felidae",
                    Subgroup == "Spider"~ "Spider",
                    Subgroup == "Raptor"~ "Raptor",
                    Subgroup == "Snake"~ "Snake",
                    Subgroup == "Crocodile"~ "Crocodile",
                    Subgroup == "Canidae"~ "Canidae",
                    Subgroup == "Ursus"~ "Ursus",
                    Subgroup == "Hyenidae"~"Hyenidae",
                    Subgroup == "Primate"~ "Primate",
                     T ~ "Others"))



write.csv(BDD_age_complet_Groups_Interet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAge/BDD_age_complet_Groups_Interet.csv"), row.names=T)

```



Graphique Boxplot

```{r}
Score_age_Boxplot_Interet=ggplot(BDD_age_complet_Groups_Interet, aes(x=Interet , y =EloScore , col=Age)) + 
  geom_boxplot() +
  
  
 scale_color_manual(name = "Age", values = c("blue","red") ,labels=c("under 30\nyears old","over 30\nyears old"))+
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  
  ylab("Elo Score")  + 
  xlab("Group") + 
  
  ggtitle("Elo Score") +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  theme(axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) 
  
  
  
Score_age_Boxplot_Interet

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Boxplot_Age.jpg", plot = Score_age_Boxplot_Interet, width = 11, height = 8)
```







-----------Critere ACADEMIE


```{r}
table(gform_tot$Academic)
```


Regroupons des categories

```{r}
gform_tot_academic =  mutate(gform_tot,
                    CatAcademic = case_when(
                    Academic == "High school"|Academic =="Middle school" ~ "High school + Middle school",
                    Academic == "Kindergarten" |Academic =="Primary school" ~ "Kindergarten + Primary school",
                    
                    Academic == "High school diploma"~ "High school diploma",
                    Academic == "Master's degree"~ "Master's degree",
                    Academic == "One/two/three-year technical/university degree"~ "One/two/three-year technical/university degree",
                    Academic == "PhD and more"~ "PhD and more",
                   
                  
                     T ~ "Other"))


gform_tot_academic$CatAcademic = as.factor(gform_tot_academic$CatAcademic)

write.csv(gform_tot_academic, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/clean Data/GoogleForm/gform_tot_academic.csv"), row.names=T)
```





Tableaux avec les rangs

```{r}
BDD_academic_rang <- past_BDD_elo(Elo_tot, gform_tot_academic, "CatAcademic", type="rank", runs = 100)

write.csv(BDD_academic_rang, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_rang.csv"), row.names=T)

```

Tableaux avec les scores

```{r}
BDD_academic_score <- past_BDD_elo(Elo_tot, gform_tot_academic, "CatAcademic", type="Score", runs = 100) 

#BDD_sexe_score <- BDD_sexe[, c("A1","A2","A3")]  ==> enlever colonne des especes

write.csv(BDD_academic_score, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDacademic/BDD_academic_score.csv"), row.names=F)
```




```{r}
kendall(BDD_academic_score[, c("High school + Middle school", "High school diploma","Kindergarten + Primary school","Master's degree","One/two/three-year technical/university degree","Other","PhD and more")])
```




Coefficient de Correlation Intra-classe



```{r}
icc(BDD_academic_score[, c("High school + Middle school", "High school diploma","Kindergarten + Primary school","Master's degree","One/two/three-year technical/university degree","Other","PhD and more")], model="twoway", type="consistency", unit="average")
```


Fonction des correlations croisees entre A1 A2 et A3

```{r}

gg2=chart.Correlation(BDD_academic_score[, c("High school + Middle school", "High school diploma","Kindergarten + Primary school","Master's degree","One/two/three-year technical/university degree","Other","PhD and more")],histogram=TRUE,pch=19)

gg2

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Cor_Academic.jpg", plot = gg2, width = 11, height = 8)
```


==> Faire des graphiques et des analyses plus simples


Transformation des tableaux variables en tableaux observations

```{r}

BDD_academic_score_all = melt ( BDD_academic_score, id.vars = c("name"))


BDD_academic_rang_all = melt ( BDD_academic_rang, id.vars = c("name"))


write.csv(BDD_academic_score_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_score_all.csv"), row.names=F)


write.csv(BDD_academic_rang_all, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_rang_all.csv"), row.names=F)
```


Renommer les noms des variables

```{r}
names(BDD_academic_score_all) = c("Name","Academic","EloScore")
names(BDD_academic_rang_all) = c("Name","Academic","EloRank")
```

Combiner Tableaux rang et score
```{r}
BDD_academic_complet <- left_join(BDD_academic_score_all, BDD_academic_rang_all, by=c("Name","Academic"))


write.csv(BDD_academic_complet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_complet.csv"), row.names=F)

```

Ranger le tableaux selon les rang

```{r}
BDD_academic_complet<- BDD_academic_complet[order(BDD_academic_complet$EloRank, decreasing =F),]
```

Graphique des Scores selon les Sexes

```{r}
classement_academic=ggplot(BDD_academic_complet, aes(x=EloRank , y =EloScore , col =Academic)) + 
  geom_point() +
  scale_color_manual(name = "Academic", values = c("blue","red","green","Black","Brown","Yellow","purple"), labels = c("High school + Middle school", "High school diploma","Kindergarten + Primary school","Master's degree","One/two/three-year technical/university degree","Other","PhD and more"))+
  
  ylab("Elo Score")  + 
  xlab("Rank") + 
  ggtitle("Pictures Ranking ") +
  
  theme( axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14)) + 
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))
 
  
  
classement_academic

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Classement_Academic.jpg", plot = classement_academic, width = 11, height = 8)
```


Utilisation du tableau Groups pour faire des groupes d'animaux
Comparaison des moyennes des scores des groupes d'animaux selon le sexe


```{r}

BDD_academic_score_Groups = left_join(BDD_academic_score,Groups, by=c(name="Name2"))


write.csv(BDD_academic_score_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_score_Groups.csv"), row.names=F)

```



```{r}

BDD_academic_complet_Groups = left_join(BDD_academic_complet,Groups, by=c(Name="Name2"))


write.csv(BDD_academic_complet_Groups, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_complet_Groups.csv"), row.names=F)

```


Creation nouveau tableau avec nouvelle colonne interet qui repertorie les groupes que l'on souhaite mettre en evidence dans le graphique


```{r}
BDD_academic_complet_Groups_Interet =  mutate(BDD_academic_complet_Groups,
                    Interet = case_when(
                    Subgroup == "Felidae" ~ "Felidae",
                    Subgroup == "Spider"~ "Spider",
                    Subgroup == "Raptor"~ "Raptor",
                    Subgroup == "Snake"~ "Snake",
                    Subgroup == "Crocodile"~ "Crocodile",
                    Subgroup == "Canidae"~ "Canidae",
                    Subgroup == "Ursus"~ "Ursus",
                    Subgroup == "Hyenidae"~"Hyenidae",
                    Subgroup == "Primate"~ "Primate",
                     T ~ "Others"))



write.csv(BDD_academic_complet_Groups_Interet, file = file.path("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/BDD/BDDAcademic/BDD_academic_complet_Groups_Interet.csv"), row.names=T)

```



Graphique Boxplot

```{r}
Score_academic_Boxplot_Interet=ggplot(BDD_academic_complet_Groups_Interet, aes(x=Interet , y =EloScore , col=Academic)) + 
  geom_boxplot() +
  
  
 scale_color_manual(name = "Academic level", values = c("blue","red","green","Black","Brown","Yellow","purple"), labels = c("High school + Middle school", "High school diploma","Kindergarten + Primary school","Master's degree","One/two/three-year technical/university degree","Other","PhD and more"))+
  
  theme(legend.title = element_text(color = "black", size = 15), legend.text = element_text(color = "black",size=12))+
  
  
  ylab("Elo Score")  + 
  xlab("Group") + 
  
  ggtitle("Elo Score") +
  theme(plot.title = element_text(size=14),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+
  
  theme(axis.line = element_line(colour = "black", size = 1.1, linetype = "solid")) +
  theme(axis.text.x = element_text(color="black", size=14),axis.text.y = element_text(color="black", size=14)) 
  
  
  
Score_academic_Boxplot_Interet

ggsave("F:/Stage M2/Questionnaire/Project/Lost-in-Wilderness/Result/Graphs/Boxplot_Academic.jpg", plot = Score_academic_Boxplot_Interet, width = 11, height = 8)
```





=============================TEST pour resoudre Bug

```{r}
dataset_photo = Elo_tot
dataset_answers = gform_tot_academic
factor = "CatAcademic"
level = "Master's degree"
startvalue = 1500
runs = 10
type= "score" 
type = "rank" 
```





```{r}
get_BDD_elo <- function(dataset_photo, dataset_answers, factor, level, type="score", startvalue = 1500, runs = 10) {
  
  col_temp <- dataset_answers[,colnames(dataset_answers)==factor]
  id <- dataset_answers$judge_id[col_temp==level]
  BDD <- dataset_photo[dataset_photo$judge_id %in% id,]
  res <- elochoice(winner = BDD$winner, loser = BDD$loser, startvalue = startvalue, runs = runs)
  temp <- ratings(res, drawplot=F)
  temp2 <- data_frame(name = names(temp), EloScore = temp)
  if (type=="rank") {
    temp2$Rank <- order(temp2$EloScore, decreasing=F)
    temp2$EloScore <- NULL
  }
  temp3 <- temp2[order(temp2$name), ]
  return(temp3)
}

```



```{r}

past_BDD_elo <- function(dataset_photo, dataset_answers, factor, type= "score", startvalue = 1500, runs = 10) {

  levels_factor <- levels(dataset_answers[,colnames(dataset_answers)==factor])
  n <- length(levels_factor)
  species <- sort(unique(c(as.character(dataset_photo$challenger_1), as.character(dataset_photo$challenger_2))),decreasing = FALSE)
  BDD <- data_frame(name = species)
  for (i in 1:n) {
    BDD_temp <- get_BDD_elo(dataset_photo, dataset_answers, factor, levels_factor[1], type, startvalue = 1500, runs = 10)
    BDD <- left_join(BDD, BDD_temp, by="name")
  }
  colnames(BDD) <-c("name", levels_factor)
  return(BDD)
}


```
































